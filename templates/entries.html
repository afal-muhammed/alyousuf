{% extends 'base.html' %}
{% load static %}
{% block content %}
	<div id="Add_Product_Out" class="modal fade">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Job opportunity</h3>
            </div>
            <div class="modal-body mdl-bdy">
				              <form role="form" id="job-opportunity" action="">
								  {% csrf_token %}
                      <div class="form-group">
                          <div class="row profile-disp">
                            <div class="col-md-6">
                               <input type="file" name="company-logo" class="hidden" id="upload" accept="image/*"
                                      onchange="showPreview(event);">
                                <div class="profile-mobile profile-image">
                                    <img style="border-radius:50%;" src="{% static 'images/jobs.jpg' %}"
                                         class="prof-img class-pointer" onclick="imageUpload()" id="image">
                                    <span class="class-pointer up-image-text display-block" onclick="imageUpload()">+Upload Company Logo</span>
                                   </div>

                            </div>
                        </div>
                    </div>
                     <div class="form-group">
                        <label class="control-label">Job Title</label>
                        <div>
                            <input type="text" class="form-control input-lg" name="job-title">
                        </div>
                    </div>
<!--                    <div class="form-group">-->
<!--                        <label class="control-label">Item Description</label>-->
<!--                        <div>-->
<!--                            <input type="text" class="form-control input-lg" name="part_description" value="" id="part_description">-->
<!--                        </div>-->
<!--                    </div>-->
                    <div class="form-group">
                        <label class="control-label">Job Description</label>
                        <div>
                            <textarea rows="5" class="form-control input-lg" name="job-description"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Location</label>
                        <div>
                            <input type="text" class="form-control input-lg" name="job-location">
                        </div>
                    </div>
                     <div class="form-group">
                        <label class="control-label">Company Name</label>
                        <div>
                            <input type="text" class="form-control input-lg" name="company-name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Contact Number</label>
                        <div>
                            <input type="text" class="form-control input-lg" name="contact">
                        </div>
                    </div>
                    <div class="form-group">
                        <div>
                            <button type="submit" class="btn">
                                ADD
                            </button>
                             <button type="submit" class="btn" data-dismiss="modal">
                                CANCEL
                            </button>
                        </div>
                    </div>
								  <div class="error1"></div>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
	{% if request.GET.grid == "False" or not request.GET.grid and not request.GET.page%}
    <caption><h3 class="header_text">Job listings</h3></caption>
	<table id="example" class="table table-bordered display" style="width:100%">
    		<thead class="thead-dark">
            		<tr>
				<th>Job Title</th>
				<th>Job Description</th>
<!--				<th>Purchased Count</th>-->
<!--				<th>Allocated Count</th>-->
                <th>Job location</th>
                <th>Company Name</th>
                <th>contact</th>
<!--                <th>Box</th>-->
<!--                <th>Hole</th>-->
<!--                        <th>Remarks</th>-->
<!--                        <th>Need to purchase?</th>-->

            		</tr>
        	</thead>
        	{% if job_listings %}
        	<tbody>
    		{% for item in job_listings %}
		<tr>
        		<td>{{ item.title }}</td>
			<td>{% if item.job_description %}{{ item.job_description }}{% endif %}</td>
			<td>{{ item.location }}</td>
			<td>{{ item.company_name }}</td>
			<td>{{ item.phone_number }}</td>
        </tr>

	{% empty %}
		</tbody>
		<tfoot>
            		<tr>
				<th>Title</th>
				<th>Job Description</th>
                <th>Location</th>
				<th>Company Name</th>
				<th>Contact Number</th>
            		</tr>
        	</tfoot>
	</table>
    		<p>No details are available.</p>

{% endfor %}


{% endif %}

{% else %}
<section class="hero-wrap d-flex align-items-center pd-top">
    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="hero-title">
                <h1>Looking for a Job?</h1>
                <h3>Find out perfect job from {{events.count}} listings </h3>
            </div>
        </div>
    </div>
</section>
<section class="main-block featured-wrap">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="titile-block">
                    {% if page_obj %}
                    <p>These listings are featured by our community
                    <a href="{% url 'landing' %}?grid=False"><i class="fa fa-list" style="color:#dc3545d6;" aria-hidden="true"></i></a></p>
                    {% else %}
                    <h2>No Jobs to list</h2>
                    <p>You can add one going to the listing page
                        <a href="{% url 'landing' %}?grid=False"><i class="fa fa-list" style="color:#dc3545d6;" aria-hidden="true"></i></a></p>
                    <p>or <a class="click-here" href="{% url 'importer' %}">click here to import</a></p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="row">
            {% for job in page_obj %}
            <div class="col-md-4 card-1">
                <div class="card">
                        <img class="card-img-top card-image" src="{{job.get_job_image}}" alt="Card image cap">
                        <div class="card-body">
                            <h5 class="card-title">{{job.title}}</h5>
<!--                            <ul class="">-->
<!--                                                            <i class="fa fa-circle" aria-hidden="true"></i>-->
<!--                                Posted Date:{{job.posted_date}}-->
                                <!--                            <i class="fa fa-circle" aria-hidden="true"></i>-->
<!--                                <li>end date:{{event.end_date}}</li>-->
                                <!--                            <li>-->
                                <!--                                <svg xmlns="http://www.w3.org/2000/svg" class="card-svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 390.762 390.762" style="enable-background:new 0 0 390.762 390.762;" xml:space="preserve" width="512px" height="512px"><g><g>-->
                                <!--<path d="M384.425,149.124c-0.594-2.766-3.038-4.741-5.866-4.741H70.514c-2.829,0-5.272,1.975-5.866,4.741   c-0.976,4.544-1.828,9.133-2.579,13.751c-8.9,1.16-17.295,3.926-25.007,8.275C17.68,182.124,4.919,201.48,1.13,225.652   c-3.518,22.449,1.239,46.646,13.396,68.134c17.681,31.25,48.795,51.711,79.819,52.727c9.2,15.328,19.924,29.072,31.836,40.66   c1.12,1.089,2.622,1.699,4.184,1.699h188.344c1.563,0,3.064-0.61,4.184-1.699c20.631-20.071,37.729-46.578,49.444-76.655   c12.054-30.946,18.426-65.85,18.426-100.936C390.762,189.05,388.63,168.709,384.425,149.124z M72.37,298.378   c-8.995-5.755-17.065-14.3-22.791-24.422c-7.703-13.611-10.776-28.55-8.653-42.069c1.84-11.775,7.513-20.893,15.989-25.682   c0.473-0.269,0.962-0.506,1.45-0.747c-0.019,1.374-0.054,2.747-0.054,4.123C58.311,240.152,63.152,270.582,72.37,298.378z    M24.97,287.877c-10.829-19.142-15.085-40.581-11.984-60.366c3.21-20.479,13.86-36.786,29.979-45.913   c5.399-3.045,11.223-5.146,17.375-6.301c-0.667,5.659-1.175,11.356-1.51,17.083c-2.733,0.848-5.357,1.979-7.834,3.387   c-11.721,6.622-19.508,18.792-21.926,34.264c-2.541,16.179,1.034,33.878,10.065,49.835c9.339,16.51,23.558,29.092,39.327,34.929   c2.689,6.539,5.634,12.896,8.816,19.046C62.897,330.219,39.178,312.987,24.97,287.877z M316.246,376.872H132.827   C93.64,337.627,70.311,275.31,70.311,209.582c0-18.033,1.714-35.905,5.097-53.198h78.365v58.496h-22.499c-3.313,0-6,2.687-6,6   v71.997c0,3.313,2.687,6,6,6h56.997c3.313,0,6-2.687,6-6V220.88c0-3.313-2.687-6-6-6h-22.499v-58.496h207.892   c3.383,17.293,5.097,35.165,5.097,53.198C378.762,275.31,355.433,337.627,316.246,376.872z M182.272,226.88v59.997h-44.997V226.88   H182.272z"-->
                                <!--      data-original="#000000" class="active-path" data-old_color="#ff6b6b" fill="#ff6b6b"/>-->
                                <!--<path d="M168.587,121.885c0,3.313,2.687,6,6,6s6-2.687,6-6c0-8.135,1.839-11.967,3.969-16.404   c2.415-5.03,5.151-10.731,5.151-21.596s-2.736-16.566-5.151-21.596c-2.129-4.437-3.969-8.269-3.969-16.404   c0-8.133,1.839-11.964,3.969-16.4c2.415-5.029,5.151-10.73,5.151-21.594c0-3.313-2.687-6-6-6s-6,2.687-6,6   c0,8.133-1.839,11.965-3.969,16.401c-2.415,5.029-5.151,10.73-5.151,21.594c0,10.865,2.736,16.566,5.15,21.596   c2.13,4.437,3.969,8.269,3.969,16.404s-1.839,11.967-3.969,16.404C171.323,105.319,168.587,111.02,168.587,121.885z"-->
                                <!--      data-original="#000000" class="active-path" data-old_color="#ff6b6b" fill="#ff6b6b"/>-->
                                <!--<path d="M213.977,121.885c0,3.313,2.687,6,6,6s6-2.687,6-6c0-8.135,1.839-11.967,3.969-16.404   c2.415-5.03,5.151-10.731,5.151-21.596s-2.736-16.566-5.151-21.596c-2.129-4.437-3.969-8.269-3.969-16.404   c0-8.133,1.839-11.964,3.969-16.4c2.415-5.029,5.151-10.73,5.151-21.594c0-3.313-2.687-6-6-6s-6,2.687-6,6   c0,8.133-1.839,11.965-3.969,16.401c-2.415,5.029-5.151,10.73-5.151,21.594c0,10.865,2.736,16.566,5.15,21.596   c2.13,4.437,3.969,8.269,3.969,16.404s-1.839,11.967-3.969,16.404C216.713,105.319,213.977,111.02,213.977,121.885z"-->
                                <!--      data-original="#000000" class="active-path" data-old_color="#ff6b6b" fill="#ff6b6b"/>-->
                                <!--<path d="M259.367,121.885c0,3.313,2.687,6,6,6s6-2.687,6-6c0-8.135,1.839-11.967,3.969-16.404c2.414-5.03,5.15-10.731,5.15-21.596   s-2.736-16.566-5.15-21.596c-2.13-4.437-3.969-8.269-3.969-16.404c0-8.133,1.839-11.964,3.969-16.4   c2.415-5.029,5.151-10.73,5.151-21.594c0-3.313-2.687-6-6-6s-6,2.687-6,6c0,8.133-1.839,11.965-3.969,16.401   c-2.415,5.029-5.151,10.73-5.151,21.594c0,10.865,2.736,16.566,5.151,21.596c2.129,4.437,3.969,8.269,3.969,16.404   s-1.839,11.967-3.969,16.404C262.103,105.319,259.367,111.02,259.367,121.885z"-->
                                <!--      data-original="#000000" class="active-path" data-old_color="#ff6b6b" fill="#ff6b6b"/>-->
                                <!--</g></g> </svg>-->
                                <!--                                Cafe-->
                                <!--                            </li>-->
<!--                            </ul>-->
                            <p class="card-text">

                                {{ job.job_description|linebreaks|safe|truncatewords:20 }}
                                {% ifnotequal job.job_description job.job_description|truncatewords:20 %}
                                {%endifnotequal%}
                            </p>
                        </div>
                        <div class="card-bottom">
                            <p><i class="ti-location-pin"></i>{{job.location}}</p>
                            <span class="open-close_green">
                            </span>
                        </div>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% if page_obj %}
     <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
          </li>
        {% endif %}
        {% for i in page_obj.paginator.page_range %}
          {% if page_obj.number == i %}
            <li class="page-item active" aria-current="page">
              <span class="page-link">
                {{ i }}
                <span class="sr-only">(current)</span>
              </span>
            </li>
          {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
          {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
          </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
    <!--end of Pagination-->

</section>
{% endif %}



<script type="text/javascript">
			$(document).ready(function() {
    				$('#example').DataTable({
        "aLengthMenu": [[25, 50, 75, -1], [25, 50, 75, "All"]],
        "iDisplayLength": 25
    });             {% if request.user.is_authenticated %}
					$('.dataTables_paginate').prepend('<i class="fa fa-plus cursor" id="add-button" data-toggle="modal" data-target="#Add_Product_Out" aria-hidden="true">ADD</i>')
                    {% endif %}
                $('.dataTables_info').prepend('<a href="{% url 'importer' %}"><button id="export" class="btn cursor export" >Import</button></a>')
                $('.dataTables_filter').prepend('<a href="{% url 'landing' %}?grid=True"><i class="fa fa-th" style="color:#dc3545d6;" aria-hidden="true"></a>')

			} );

    function showPreview(event){
  if(event.target.files.length > 0){
    var src = URL.createObjectURL(event.target.files[0]);
    var preview = document.getElementById("image");
    preview.src = src;
    preview.style.display = "block";
  }
}
function imageUpload(){
        $('#upload').click();
	}

	$("#job-opportunity").submit(function(e) {
       e.preventDefault();
       var formData = new FormData(this);
       $.ajax({
       url : "{% url 'landing' %}",
       type : "POST",
       data : formData,
       dataType:'json',
       contentType: false,
       processData: false,
           success : function(data) {
           console.log(data);
               if (data.result != "success")
                {
                 response = data.result;
                 $('.error1').html(response);
               }
               else{
               window.location.href = '{% url 'landing' %}';
                   }

            },
           // handle a non-successful response
           error : function(xhr,errmsg,errors) {
           console.log(xhr.status + ": " + xhr.responseText);
           console.log(errors)// provide a bit more info about the error to the console
           }
       });
   });

	</script>


{% endblock %}
